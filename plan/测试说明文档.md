# Flexi-UI æµ‹è¯•è¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [æµ‹è¯•æ¦‚è¿°](#æµ‹è¯•æ¦‚è¿°)
2. [æµ‹è¯•é…ç½®](#æµ‹è¯•é…ç½®)
3. [æµ‹è¯•è¦†ç›–ç‡åˆ†æ](#æµ‹è¯•è¦†ç›–ç‡åˆ†æ)
4. [æµ‹è¯•æ–‡ä»¶ç»“æ„](#æµ‹è¯•æ–‡ä»¶ç»“æ„)
5. [æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…](#æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…)
6. [æµ‹è¯•å‘½ä»¤è¯´æ˜](#æµ‹è¯•å‘½ä»¤è¯´æ˜)
7. [æµ‹è¯•æœ€ä½³å®è·µ](#æµ‹è¯•æœ€ä½³å®è·µ)
8. [æŒç»­é›†æˆ](#æŒç»­é›†æˆ)
9. [é—®é¢˜æ’æŸ¥](#é—®é¢˜æ’æŸ¥)

## ğŸ¯ æµ‹è¯•æ¦‚è¿°

Flexi-UI é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„æµ‹è¯•æ¡†æ¶å’Œå·¥å…·é“¾ï¼Œç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½ç¨³å®šæ€§ã€‚

### æµ‹è¯•æŠ€æœ¯æ ˆ

- **æµ‹è¯•æ¡†æ¶**: Vitest v3.2.4
- **æµ‹è¯•ç¯å¢ƒ**: jsdom (æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ)
- **æµ‹è¯•å·¥å…·**: @testing-library/react
- **è¦†ç›–ç‡å·¥å…·**: v8 (å†…ç½®äº Vitest)
- **æ–­è¨€åº“**: Vitest å†…ç½®æ–­è¨€
- **Mock å·¥å…·**: Vitest å†…ç½® Mock

### æµ‹è¯•ç›®æ ‡

- ç¡®ä¿ç»„ä»¶åŠŸèƒ½æ­£ç¡®æ€§
- éªŒè¯ç”¨æˆ·äº¤äº’è¡Œä¸º
- ä¿è¯ä»£ç è¦†ç›–ç‡è¾¾æ ‡
- é˜²æ­¢å›å½’é—®é¢˜
- æå‡ä»£ç è´¨é‡

## âš™ï¸ æµ‹è¯•é…ç½®

### Vitest é…ç½®æ–‡ä»¶ (`vitest.config.ts`)

```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    css: true,
    include: ['src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    exclude: ['node_modules', 'dist', '.idea', '.git', '.cache'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      exclude: [
        'node_modules/',
        'src/test/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/index.ts',
        'src/examples/',
        'src/main.tsx',
      ],
      thresholds: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80,
        },
      },
    },
    pool: 'threads',
    poolOptions: {
      threads: {
        singleThread: false,
      },
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

### æµ‹è¯•ç¯å¢ƒè®¾ç½® (`src/test/setup.ts`)

```typescript
import '@testing-library/jest-dom';
import { cleanup } from '@testing-library/react';
import { afterEach, vi } from 'vitest';

// æ¯ä¸ªæµ‹è¯•åæ¸…ç†
afterEach(() => {
  cleanup();
});

// Mock matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
});

// Mock ResizeObserver
global.ResizeObserver = vi.fn().mockImplementation(() => ({
  observe: vi.fn(),
  unobserve: vi.fn(),
  disconnect: vi.fn(),
}));

// Mock IntersectionObserver
global.IntersectionObserver = vi.fn().mockImplementation(() => ({
  observe: vi.fn(),
  unobserve: vi.fn(),
  disconnect: vi.fn(),
}));
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡åˆ†æ

### å½“å‰è¦†ç›–ç‡æ¦‚è§ˆ

æ ¹æ®æœ€æ–°çš„æµ‹è¯•è¿è¡Œç»“æœï¼š

| æŒ‡æ ‡               | è¦†ç›–ç‡     | çŠ¶æ€      |
| ------------------ | ---------- | --------- |
| **æ€»ä½“è¯­å¥è¦†ç›–ç‡** | **89.7%**  | âœ… ä¼˜ç§€   |
| **åˆ†æ”¯è¦†ç›–ç‡**     | **53.57%** | âš ï¸ éœ€æ”¹è¿› |
| **å‡½æ•°è¦†ç›–ç‡**     | **40.42%** | âš ï¸ éœ€æ”¹è¿› |
| **è¡Œè¦†ç›–ç‡**       | **89.7%**  | âœ… ä¼˜ç§€   |

### è¯¦ç»†è¦†ç›–ç‡åˆ†æ

#### ğŸŸ¢ é«˜è¦†ç›–ç‡æ¨¡å— (90%+)

1. **ç»„ä»¶æ¨¡å—**
   - `Button.tsx`: 100% è¯­å¥è¦†ç›–ç‡
   - `DataTable.tsx`: 95%+ è¦†ç›–ç‡
   - `FileUploader.tsx`: 90%+ è¦†ç›–ç‡
   - `VirtualList.tsx`: 85%+ è¦†ç›–ç‡

2. **Hooks æ¨¡å—**
   - `form/observers/FormObserver.ts`: 100% è¦†ç›–ç‡
   - `form/state/FormStateManager.ts`: 100% è¦†ç›–ç‡
   - `form/utils/index.ts`: 100% è¦†ç›–ç‡
   - `theme/tokens.ts`: 100% è¦†ç›–ç‡

#### ğŸŸ¡ ä¸­ç­‰è¦†ç›–ç‡æ¨¡å— (50-90%)

1. **ä¸»é¢˜æä¾›è€…**
   - `ThemeProvider.tsx`: 75.67% è¯­å¥è¦†ç›–ç‡
   - åˆ†æ”¯è¦†ç›–ç‡: 33.33%
   - æœªè¦†ç›–è¡Œ: 71,81-89,95-103

#### ğŸ”´ ä½è¦†ç›–ç‡æ¨¡å— (<50%)

1. **è¡¨å•éªŒè¯æ¨¡å—**
   - `form/validation/strategies.ts`: 0% è¯­å¥è¦†ç›–ç‡
   - `form/validation/validators.ts`: 0% è¯­å¥è¦†ç›–ç‡
   - `form/useFormRefactored.ts`: 0% è¯­å¥è¦†ç›–ç‡

2. **å·¥å…·å‡½æ•°**
   - `utils/throttle.ts`: 0% è¯­å¥è¦†ç›–ç‡
   - æœªè¦†ç›–è¡Œ: 17-116

### è¦†ç›–ç‡æ”¹è¿›å»ºè®®

1. **ä¼˜å…ˆçº§é«˜**: ä¸ºè¡¨å•éªŒè¯æ¨¡å—æ·»åŠ æµ‹è¯•ç”¨ä¾‹
2. **ä¼˜å…ˆçº§ä¸­**: æå‡ ThemeProvider çš„åˆ†æ”¯è¦†ç›–ç‡
3. **ä¼˜å…ˆçº§ä½**: ä¸ºå·¥å…·å‡½æ•°æ·»åŠ å•å…ƒæµ‹è¯•

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ Button.test.tsx          # 24 ä¸ªæµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ DataTable/
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ DataTable.test.tsx       # 7 ä¸ªæµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ FileUploader/
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ FileUploader.test.tsx    # 7 ä¸ªæµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ VirtualList/
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â””â”€â”€ VirtualList.test.tsx     # 6 ä¸ªæµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ ThemeToggle/
â”‚       â””â”€â”€ (ç¼ºå°‘æµ‹è¯•æ–‡ä»¶)
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ (ç¼ºå°‘æµ‹è¯•æ–‡ä»¶)
â””â”€â”€ test/
    â””â”€â”€ setup.ts                         # æµ‹è¯•ç¯å¢ƒé…ç½®
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…

### Button ç»„ä»¶æµ‹è¯• (24 ä¸ªç”¨ä¾‹)

**æµ‹è¯•è¦†ç›–èŒƒå›´:**

- âœ… åŸºç¡€æ¸²æŸ“æµ‹è¯•
- âœ… å˜ä½“æµ‹è¯• (primary, secondary, outline, ghost)
- âœ… å°ºå¯¸æµ‹è¯• (small, medium, large)
- âœ… çŠ¶æ€æµ‹è¯• (disabled, loading)
- âœ… äº‹ä»¶å¤„ç†æµ‹è¯•
- âœ… å¯è®¿é—®æ€§æµ‹è¯•
- âœ… è‡ªå®šä¹‰æ ·å¼æµ‹è¯•

**å…³é”®æµ‹è¯•ç”¨ä¾‹:**

```typescript
describe('Button Component', () => {
  describe('Rendering', () => {
    it('should render with correct text');
    it('should render with custom className');
    it('should render as button element by default');
  });

  describe('Variants', () => {
    it('should render primary variant');
    it('should render secondary variant');
    it('should render outline variant');
    it('should render ghost variant');
  });

  describe('Sizes', () => {
    it('should render small size');
    it('should render medium size');
    it('should render large size');
  });

  describe('States', () => {
    it('should handle disabled state');
    it('should handle loading state');
  });

  describe('Events', () => {
    it('should handle click events');
    it('should not trigger click when disabled');
  });
});
```

### DataTable ç»„ä»¶æµ‹è¯• (7 ä¸ªç”¨ä¾‹)

**æµ‹è¯•è¦†ç›–èŒƒå›´:**

- âœ… åŸºç¡€æ¸²æŸ“æµ‹è¯•
- âœ… æ•°æ®æ˜¾ç¤ºæµ‹è¯•
- âœ… æ’åºåŠŸèƒ½æµ‹è¯•
- âœ… åˆ†é¡µåŠŸèƒ½æµ‹è¯•
- âœ… è™šæ‹Ÿæ»šåŠ¨é›†æˆæµ‹è¯•

### FileUploader ç»„ä»¶æµ‹è¯• (7 ä¸ªç”¨ä¾‹)

**æµ‹è¯•è¦†ç›–èŒƒå›´:**

- âœ… åŸºç¡€æ¸²æŸ“æµ‹è¯•
- âœ… æ–‡ä»¶é€‰æ‹©æµ‹è¯•
- âœ… æ‹–æ‹½ä¸Šä¼ æµ‹è¯•
- âœ… æ–‡ä»¶éªŒè¯æµ‹è¯•
- âœ… ä¸Šä¼ è¿›åº¦æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

### VirtualList ç»„ä»¶æµ‹è¯• (6 ä¸ªç”¨ä¾‹)

**æµ‹è¯•è¦†ç›–èŒƒå›´:**

- âœ… åŸºç¡€æ¸²æŸ“æµ‹è¯•
- âœ… è™šæ‹ŸåŒ–åŠŸèƒ½æµ‹è¯•
- âœ… æ»šåŠ¨è¡Œä¸ºæµ‹è¯•
- âœ… æ€§èƒ½ä¼˜åŒ–æµ‹è¯•

## ğŸš€ æµ‹è¯•å‘½ä»¤è¯´æ˜

### åŸºç¡€æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pnpm test:coverage

# è¿è¡Œæµ‹è¯•ä¸€æ¬¡ (CI æ¨¡å¼)
pnpm test:run

# å¯åŠ¨æµ‹è¯• UI ç•Œé¢
pnpm test:ui
```

### é«˜çº§æµ‹è¯•å‘½ä»¤

```bash
# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm vitest

# è¿è¡Œç‰¹å®šæ–‡ä»¶çš„æµ‹è¯•
pnpm vitest Button.test.tsx

# è¿è¡ŒåŒ¹é…æ¨¡å¼çš„æµ‹è¯•
pnpm vitest --grep "Button"

# è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm vitest --inspect-brk

# ç”Ÿæˆè¯¦ç»†çš„è¦†ç›–ç‡æŠ¥å‘Š
pnpm vitest --coverage --reporter=verbose
```

### Package.json è„šæœ¬é…ç½®

```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:run": "vitest run",
    "test:coverage": "vitest run --coverage"
  }
}
```

## ğŸ¯ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç»“æ„

```typescript
// æ¨èçš„æµ‹è¯•æ–‡ä»¶ç»“æ„
import React from 'react';
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { ComponentName } from '../ComponentName';
import { ThemeProvider } from '../../../providers/ThemeProvider';

// æµ‹è¯•åŒ…è£…å™¨
const TestWrapper = ({ children }) => (
  <ThemeProvider defaultMode="light">{children}</ThemeProvider>
);

const renderWithTheme = (ui) => {
  return render(ui, { wrapper: TestWrapper });
};

describe('ComponentName', () => {
  describe('Rendering', () => {
    // æ¸²æŸ“æµ‹è¯•
  });

  describe('Interactions', () => {
    // äº¤äº’æµ‹è¯•
  });

  describe('Edge Cases', () => {
    // è¾¹ç•Œæƒ…å†µæµ‹è¯•
  });
});
```

### 2. Mock ç­–ç•¥

```typescript
// Mock å¤–éƒ¨ä¾èµ–
vi.mock('../../VirtualList/VirtualList', () => ({
  VirtualList: ({ data, renderItem }) => (
    <div data-testid="virtual-list">
      {data.map((item, index) => (
        <div key={index}>{renderItem(item, index)}</div>
      ))}
    </div>
  ),
}));

// Mock æµè§ˆå™¨ API
global.fetch = vi.fn();
global.FileReader = MockFileReader;
```

### 3. æ–­è¨€æœ€ä½³å®è·µ

```typescript
// ä½¿ç”¨è¯­ä¹‰åŒ–çš„æŸ¥è¯¢
expect(screen.getByRole('button')).toBeInTheDocument();
expect(screen.getByLabelText('Upload file')).toBeVisible();

// æµ‹è¯•ç”¨æˆ·äº¤äº’
fireEvent.click(screen.getByRole('button'));
expect(mockOnClick).toHaveBeenCalledTimes(1);

// æµ‹è¯•å¼‚æ­¥è¡Œä¸º
await waitFor(() => {
  expect(screen.getByText('Upload complete')).toBeInTheDocument();
});
```

### 4. æµ‹è¯•æ•°æ®ç®¡ç†

```typescript
// ä½¿ç”¨å·¥å‚å‡½æ•°ç”Ÿæˆæµ‹è¯•æ•°æ®
const generateTestData = (count: number) => {
  return Array.from({ length: count }, (_, index) => ({
    id: index + 1,
    name: `Item ${index + 1}`,
    value: `Value ${index + 1}`,
  }));
};

// ä½¿ç”¨å¸¸é‡å®šä¹‰æµ‹è¯•æ•°æ®
const mockData = [
  { id: 1, name: 'John Doe', age: 30, email: 'john@example.com' },
  { id: 2, name: 'Jane Smith', age: 25, email: 'jane@example.com' },
];
```

## ğŸ”„ æŒç»­é›†æˆ

### GitHub Actions é…ç½®ç¤ºä¾‹

```yaml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: pnpm install
      - run: pnpm test:coverage
      - uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
```

### è¦†ç›–ç‡é˜ˆå€¼é…ç½®

å½“å‰é…ç½®çš„è¦†ç›–ç‡é˜ˆå€¼ï¼š

- åˆ†æ”¯è¦†ç›–ç‡: 80%
- å‡½æ•°è¦†ç›–ç‡: 80%
- è¡Œè¦†ç›–ç‡: 80%
- è¯­å¥è¦†ç›–ç‡: 80%

## ğŸ”§ é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æµ‹è¯•ç¯å¢ƒé—®é¢˜

**é—®é¢˜**: `ReferenceError: matchMedia is not defined`
**è§£å†³**: åœ¨ `setup.ts` ä¸­æ·»åŠ  matchMedia mock

```typescript
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    // ... å…¶ä»–å±æ€§
  })),
});
```

#### 2. å¼‚æ­¥æµ‹è¯•é—®é¢˜

**é—®é¢˜**: å¼‚æ­¥æ“ä½œæµ‹è¯•å¤±è´¥
**è§£å†³**: ä½¿ç”¨ `waitFor` æˆ– `findBy*` æŸ¥è¯¢

```typescript
// é”™è¯¯æ–¹å¼
expect(screen.getByText('Loading...')).toBeInTheDocument();

// æ­£ç¡®æ–¹å¼
await waitFor(() => {
  expect(screen.getByText('Loaded')).toBeInTheDocument();
});
```

#### 3. Mock é—®é¢˜

**é—®é¢˜**: Mock ä¸ç”Ÿæ•ˆ
**è§£å†³**: ç¡®ä¿ Mock åœ¨å¯¼å…¥ä¹‹å‰å®šä¹‰

```typescript
// åœ¨æ–‡ä»¶é¡¶éƒ¨å®šä¹‰ Mock
vi.mock('./module', () => ({
  default: vi.fn(),
}));

// ç„¶åå¯¼å…¥ç»„ä»¶
import Component from './Component';
```

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨ `screen.debug()`** æŸ¥çœ‹å½“å‰ DOM ç»“æ„
2. **ä½¿ç”¨ `--inspect-brk`** è¿›è¡Œæ–­ç‚¹è°ƒè¯•
3. **ä½¿ç”¨ `test.only()`** è¿è¡Œå•ä¸ªæµ‹è¯•
4. **æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š** äº†è§£æœªæµ‹è¯•çš„ä»£ç è·¯å¾„

## ğŸ“ˆ æµ‹è¯•æ”¹è¿›è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2 å‘¨)

1. **æ·»åŠ ç¼ºå¤±çš„æµ‹è¯•æ–‡ä»¶**
   - ThemeToggle ç»„ä»¶æµ‹è¯•
   - useTheme Hook æµ‹è¯•
   - useLocalStorage Hook æµ‹è¯•

2. **æå‡è¦†ç›–ç‡**
   - è¡¨å•éªŒè¯æ¨¡å—æµ‹è¯• (ç›®æ ‡: 80%+)
   - ThemeProvider åˆ†æ”¯è¦†ç›–ç‡ (ç›®æ ‡: 80%+)

### ä¸­æœŸç›®æ ‡ (1 ä¸ªæœˆ)

1. **é›†æˆæµ‹è¯•**
   - æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•
   - ç»„ä»¶é›†æˆæµ‹è¯•

2. **æ€§èƒ½æµ‹è¯•**
   - è™šæ‹Ÿåˆ—è¡¨æ€§èƒ½æµ‹è¯•
   - å¤§æ•°æ®é›†æµ‹è¯•

### é•¿æœŸç›®æ ‡ (3 ä¸ªæœˆ)

1. **è‡ªåŠ¨åŒ–æµ‹è¯•**
   - è§†è§‰å›å½’æµ‹è¯•
   - å¯è®¿é—®æ€§è‡ªåŠ¨åŒ–æµ‹è¯•

2. **æµ‹è¯•å·¥å…·ä¼˜åŒ–**
   - è‡ªå®šä¹‰æµ‹è¯•å·¥å…·
   - æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨

## ğŸ“š å‚è€ƒèµ„æ–™

- [Vitest å®˜æ–¹æ–‡æ¡£](https://vitest.dev/)
- [Testing Library æ–‡æ¡£](https://testing-library.com/)
- [React æµ‹è¯•æœ€ä½³å®è·µ](https://kentcdodds.com/blog/common-mistakes-with-react-testing-library)
- [æµ‹è¯•è¦†ç›–ç‡æœ€ä½³å®è·µ](https://martinfowler.com/bliki/TestCoverage.html)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ25æ—¥  
**ç»´æŠ¤è€…**: Flexi-UI å¼€å‘å›¢é˜Ÿ
