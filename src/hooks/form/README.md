# é‡æ„åçš„è¡¨å•ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªåŸºäºç°ä»£è®¾è®¡åŸåˆ™å’Œè®¾è®¡æ¨¡å¼é‡æ„çš„Reactè¡¨å•ç®¡ç†ç³»ç»Ÿï¼Œæä¾›äº†å¼ºå¤§ã€çµæ´»ä¸”æ˜“äºæ‰©å±•çš„è¡¨å•è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ è®¾è®¡åŸåˆ™

### 1. å•ä¸€èŒè´£åŸåˆ™ (SRP)
- **éªŒè¯å™¨**: æ¯ä¸ªéªŒè¯ç­–ç•¥åªè´Ÿè´£ä¸€ç§éªŒè¯é€»è¾‘
- **è§‚å¯Ÿè€…**: æ¯ä¸ªè§‚å¯Ÿè€…åªå¤„ç†ç‰¹å®šç±»å‹çš„äº‹ä»¶
- **çŠ¶æ€ç®¡ç†**: çŠ¶æ€ç®¡ç†å™¨åªè´Ÿè´£çŠ¶æ€è½¬æ¢é€»è¾‘
- **å‘½ä»¤**: æ¯ä¸ªå‘½ä»¤åªæ‰§è¡Œä¸€ä¸ªç‰¹å®šæ“ä½œ

### 2. å¼€é—­åŸåˆ™ (OCP)
- é€šè¿‡æ¥å£å®šä¹‰æ‰©å±•ç‚¹ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç å³å¯æ·»åŠ æ–°åŠŸèƒ½
- éªŒè¯ç­–ç•¥å¯ä»¥è½»æ¾æ‰©å±•æ–°çš„éªŒè¯è§„åˆ™
- è§‚å¯Ÿè€…å¯ä»¥æ·»åŠ æ–°çš„äº‹ä»¶å¤„ç†é€»è¾‘

### 3. ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
- é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–äºæŠ½è±¡
- ä½¿ç”¨æ¥å£å®šä¹‰å¥‘çº¦ï¼Œå…·ä½“å®ç°å¯ä»¥æ›¿æ¢

### 4. æ¥å£éš”ç¦»åŸåˆ™ (ISP)
- å®šä¹‰äº†ç»†ç²’åº¦çš„æ¥å£ï¼Œå®¢æˆ·ç«¯åªä¾èµ–å®ƒä»¬éœ€è¦çš„æ¥å£
- `IValidator`ã€`IFormObserver`ã€`IValidationStrategy` ç­‰æ¥å£èŒè´£æ˜ç¡®

### 5. é‡Œæ°æ›¿æ¢åŸåˆ™ (LSP)
- æ‰€æœ‰å®ç°ç±»éƒ½å¯ä»¥æ›¿æ¢å…¶åŸºç±»è€Œä¸å½±å“ç¨‹åºæ­£ç¡®æ€§
- éªŒè¯ç­–ç•¥ã€è§‚å¯Ÿè€…ç­‰éƒ½å¯ä»¥æ— ç¼æ›¿æ¢

### 6. æœ€å°‘çŸ¥è¯†åŸåˆ™ (LoD)
- ç»„ä»¶åªä¸ç›´æ¥æœ‹å‹é€šä¿¡ï¼Œå‡å°‘è€¦åˆ
- ä½¿ç”¨å¤–è§‚æ¨¡å¼éšè—å¤æ‚çš„å†…éƒ¨å®ç°

### 7. ç»„åˆ/èšåˆå¤ç”¨åŸåˆ™
- ä¼˜å…ˆä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿
- ç»„åˆéªŒè¯å™¨ã€è£…é¥°å™¨æ¨¡å¼ç­‰éƒ½ä½“ç°äº†è¿™ä¸€åŸåˆ™

### 8. KISSåŸåˆ™ (Keep It Simple, Stupid)
- APIè®¾è®¡ç®€æ´æ˜äº†
- å¤æ‚é€»è¾‘è¢«å°è£…åœ¨å†…éƒ¨ï¼Œå¯¹å¤–æä¾›ç®€å•æ¥å£

### 9. YAGNIåŸåˆ™ (You Aren't Gonna Need It)
- åªå®ç°å½“å‰éœ€è¦çš„åŠŸèƒ½
- é¿å…è¿‡åº¦è®¾è®¡å’Œä¸å¿…è¦çš„å¤æ‚æ€§

### 10. DRYåŸåˆ™ (Don't Repeat Yourself)
- æå–å…¬å…±å·¥å…·å‡½æ•°
- ä½¿ç”¨æ¨¡æ¿æ–¹æ³•æ¨¡å¼é¿å…é‡å¤ä»£ç 

## ğŸ—ï¸ è®¾è®¡æ¨¡å¼

### åˆ›å»ºå‹æ¨¡å¼

#### 1. å·¥å‚æ¨¡å¼ (Factory Pattern)
```typescript
// ValidatorFactory æä¾›åˆ›å»ºéªŒè¯å™¨çš„å·¥å‚æ–¹æ³•
const validator = ValidatorFactory.createEmail('è¯·è¾“å…¥æœ‰æ•ˆé‚®ç®±')
```

#### 2. å»ºé€ è€…æ¨¡å¼ (Builder Pattern)
```typescript
// ä½¿ç”¨å»ºé€ è€…æ¨¡å¼åˆ›å»ºå¤æ‚çš„éªŒè¯å™¨
const validator = validators.string()
  .required('å¿…å¡«')
  .minLength(3, 'è‡³å°‘3ä¸ªå­—ç¬¦')
  .email('é‚®ç®±æ ¼å¼é”™è¯¯')
  .withCache(5000)
  .build()
```

#### 3. å•ä¾‹æ¨¡å¼ (Singleton Pattern)
```typescript
// FormFacade åœ¨ useForm ä¸­ä½œä¸ºå•ä¾‹ä½¿ç”¨
if (!facadeRef.current) {
  facadeRef.current = new FormFacade(config)
}
```

### ç»“æ„å‹æ¨¡å¼

#### 1. å¤–è§‚æ¨¡å¼ (Facade Pattern)
```typescript
// FormFacade ä¸ºå¤æ‚çš„è¡¨å•æ“ä½œæä¾›ç®€å•æ¥å£
export class FormFacade<T> {
  async setFieldValue(fieldName: keyof T, value: unknown): Promise<void>
  async validateForm(): Promise<Record<keyof T, ValidationResult>>
  // ... å…¶ä»–ç®€åŒ–çš„API
}
```

#### 2. è£…é¥°å™¨æ¨¡å¼ (Decorator Pattern)
```typescript
// ä¸ºéªŒè¯å™¨æ·»åŠ ç¼“å­˜ã€æ—¥å¿—ç­‰åŠŸèƒ½
const cachedValidator = new CacheValidatorDecorator(validator, 5000)
const loggedValidator = new LogValidatorDecorator(validator, 'fieldName')
```

#### 3. ç»„åˆæ¨¡å¼ (Composite Pattern)
```typescript
// CompositeValidator å¯ä»¥ç»„åˆå¤šä¸ªéªŒè¯ç­–ç•¥
const validator = new CompositeValidator([
  new RequiredValidationStrategy(),
  new EmailValidationStrategy()
])
```

#### 4. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)
```typescript
// å°†æ—§çš„éªŒè¯å‡½æ•°é€‚é…åˆ°æ–°çš„éªŒè¯æ¥å£
class LegacyValidatorAdapter implements IValidator {
  constructor(private legacyValidator: (value: any) => boolean) {}
  
  validate(value: unknown): ValidationResult {
    const isValid = this.legacyValidator(value)
    return { isValid, message: isValid ? undefined : 'éªŒè¯å¤±è´¥' }
  }
}
```

### è¡Œä¸ºå‹æ¨¡å¼

#### 1. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)
```typescript
// è¡¨å•çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…
const unsubscribe = form.subscribe(new LoggingObserver())
```

#### 2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
```typescript
// ä¸åŒçš„éªŒè¯ç­–ç•¥å¯ä»¥äº’æ¢
interface IValidationStrategy {
  execute(value: unknown): ValidationResult
}
```

#### 3. å‘½ä»¤æ¨¡å¼ (Command Pattern)
```typescript
// è¡¨å•æ“ä½œå°è£…ä¸ºå‘½ä»¤ï¼Œæ”¯æŒæ’¤é”€/é‡åš
const command = new SetFieldValueCommand(context, 'email', 'test@example.com')
await commandInvoker.execute(command)
```

#### 4. çŠ¶æ€æ¨¡å¼ (State Pattern)
```typescript
// è¡¨å•åœ¨ä¸åŒçŠ¶æ€ä¸‹æœ‰ä¸åŒçš„è¡Œä¸º
class IdleFormState implements IFormState {
  handle(context: FormStateContext, action: FormAction): FormState
}
```

#### 5. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method Pattern)
```typescript
// éªŒè¯å™¨è£…é¥°å™¨æä¾›æ¨¡æ¿æ–¹æ³•
export abstract class ValidatorDecorator implements IValidator {
  async validate(value: unknown): Promise<ValidationResult> {
    // æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡å†™å…·ä½“æ­¥éª¤
    return this.validator.validate(value)
  }
}
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/hooks/form/
â”œâ”€â”€ types.ts                    # ç±»å‹å®šä¹‰
â”œâ”€â”€ validation/
â”‚   â”œâ”€â”€ strategies.ts           # éªŒè¯ç­–ç•¥å®ç°
â”‚   â””â”€â”€ validators.ts           # éªŒè¯å™¨å’Œå·¥å‚
â”œâ”€â”€ observers/
â”‚   â””â”€â”€ FormObserver.ts         # è§‚å¯Ÿè€…å®ç°
â”œâ”€â”€ state/
â”‚   â””â”€â”€ FormStateManager.ts     # çŠ¶æ€ç®¡ç†
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ index.ts               # å·¥å…·å‡½æ•°
â”œâ”€â”€ useFormRefactored.ts        # ä¸»è¦Hook
â”œâ”€â”€ index.ts                   # å¯¼å‡ºæ–‡ä»¶
â””â”€â”€ README.md                  # æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```typescript
import { useFormRefactored, validators } from './hooks/form'

const formConfig = {
  initialValues: {
    email: '',
    password: ''
  },
  validationSchema: {
    email: validators.string()
      .required('é‚®ç®±ä¸èƒ½ä¸ºç©º')
      .email('è¯·è¾“å…¥æœ‰æ•ˆé‚®ç®±')
      .build(),
    password: validators.string()
      .required('å¯†ç ä¸èƒ½ä¸ºç©º')
      .minLength(8, 'å¯†ç è‡³å°‘8ä½')
      .build()
  }
}

function LoginForm() {
  const form = useFormRefactored(formConfig)
  
  const handleSubmit = async (values) => {
    console.log('æäº¤:', values)
  }
  
  return (
    <FormRefactored config={formConfig} onSubmit={handleSubmit}>
      {/* è¡¨å•å†…å®¹ */}
    </FormRefactored>
  )
}
```

### 2. è‡ªå®šä¹‰éªŒè¯å™¨

```typescript
// åˆ›å»ºè‡ªå®šä¹‰éªŒè¯ç­–ç•¥
class CustomValidationStrategy extends BaseValidationStrategy {
  execute(value: unknown): ValidationResult {
    // è‡ªå®šä¹‰éªŒè¯é€»è¾‘
    return { isValid: true }
  }
}

// ä½¿ç”¨å»ºé€ è€…æ¨¡å¼
const validator = validators.string()
  .custom(new CustomValidationStrategy())
  .build()
```

### 3. æ·»åŠ è§‚å¯Ÿè€…

```typescript
// æ·»åŠ æ—¥å¿—è§‚å¯Ÿè€…
const unsubscribe = form.subscribe(new LoggingObserver('[MyForm]'))

// æ·»åŠ æŒä¹…åŒ–è§‚å¯Ÿè€…
form.subscribe(new PersistenceObserver('form-data'))

// è‡ªå®šä¹‰è§‚å¯Ÿè€…
class CustomObserver implements IFormObserver {
  onFieldChange(fieldName: string, value: unknown): void {
    console.log(`å­—æ®µ ${fieldName} å˜æ›´ä¸º:`, value)
  }
  
  onFieldError(fieldName: string, error: string): void {
    console.log(`å­—æ®µ ${fieldName} é”™è¯¯:`, error)
  }
  
  onFormSubmit(values: Record<string, unknown>): void {
    console.log('è¡¨å•æäº¤:', values)
  }
}
```

### 4. å‘½ä»¤æ¨¡å¼æ“ä½œ

```typescript
// æ’¤é”€/é‡åšæ“ä½œ
if (form.canUndo()) {
  await form.undo()
}

if (form.canRedo()) {
  await form.redo()
}

// æ‰¹é‡è®¾ç½®å€¼
await form.batchSetFieldValues({
  email: 'test@example.com',
  password: 'newpassword'
})
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. ç¼“å­˜éªŒè¯ç»“æœ

```typescript
const validator = validators.string()
  .email()
  .withCache(5000) // ç¼“å­˜5ç§’
  .build()
```

### 2. éªŒè¯æ—¥å¿—

```typescript
const validator = validators.string()
  .email()
  .withLogging('email-field')
  .build()
```

### 3. å¼‚æ­¥éªŒè¯

```typescript
const asyncValidator = validators.async(
  async (value) => {
    const response = await fetch(`/api/check-username/${value}`)
    return response.ok
  },
  'ç”¨æˆ·åå·²å­˜åœ¨'
).build()
```

### 4. è¡¨å•ç»Ÿè®¡

```typescript
const stats = form.getFormStats()
console.log('å®Œæˆç‡:', stats.completionRate)
console.log('é”™è¯¯ç‡:', stats.errorRate)
```

## ğŸ¨ æ ·å¼å®šåˆ¶

ç³»ç»Ÿæä¾›äº†å®Œæ•´çš„CSSæ ·å¼ï¼Œæ”¯æŒ:
- å“åº”å¼è®¾è®¡
- æ·±è‰²æ¨¡å¼
- åŠ¨ç”»æ•ˆæœ
- è‡ªå®šä¹‰ä¸»é¢˜

```css
/* è‡ªå®šä¹‰ä¸»é¢˜è‰² */
:root {
  --primary-color: #3b82f6;
  --error-color: #ef4444;
  --success-color: #10b981;
}
```

## ğŸ§ª æµ‹è¯•

```typescript
// å•å…ƒæµ‹è¯•ç¤ºä¾‹
describe('FormFacade', () => {
  it('should validate field correctly', async () => {
    const facade = new FormFacade(config)
    const result = await facade.validateField('email')
    expect(result.isValid).toBe(true)
  })
})
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

1. **é˜²æŠ–éªŒè¯**: é¿å…é¢‘ç¹éªŒè¯
2. **ç»“æœç¼“å­˜**: ç¼“å­˜éªŒè¯ç»“æœ
3. **æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½éªŒè¯å™¨
4. **è™šæ‹ŸåŒ–**: å¤§è¡¨å•çš„è™šæ‹Ÿæ»šåŠ¨

## ğŸ”’ ç±»å‹å®‰å…¨

å®Œå…¨ä½¿ç”¨TypeScriptç¼–å†™ï¼Œæä¾›:
- å¼ºç±»å‹æ£€æŸ¥
- æ™ºèƒ½ä»£ç æç¤º
- ç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹
- æ³›å‹æ”¯æŒ

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œå¼€æºç¤¾åŒºçš„æ”¯æŒï¼